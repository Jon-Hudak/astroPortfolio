---
import { Image } from "@astrojs/image/components";
import { Icon } from "astro-icon";
//import navLogo from "../icons/logo-no-background.svg";
const { navbarChange } = Astro.props;
const navLogo = "/images/logo-no-background.svg";
---

<header id="navHeader" class="fixed w-screen top-0 z-50 " >
  <nav id="nav" class="flex justify-between items-center px-3 md:px-1">
    <a class="h-full" href="/" aria-label="Homepage">
      <img class="h-full" alt="" src={navLogo} />
      <!-- <Icon
          optimize
          alt="Logo"
          src={navLogo}
          
          class="h-full w-full transition duration-100 hover:grayscale hover:contrast-0"
        /> -->
    </a>
    <button
      role="navigation"
      aria-label="toggle Navigation"
      aria-controls="primary-navigation"
      aria-expanded="false"
      id="hamburgerButton"
      class="block md:hidden z-50"
      ><span class="sr-only">Menu</span>
      <svg
        id="hamburgerSvg"
        class="pointer-events-none"
        width="64"
        height="64"
        viewBox="0 0 100 100"
      >
        <path
          class="line line1 stroke-white"
          d="M 20,29.000046 H 80.000231 C 80.000231,29.000046 94.498839,28.817352 94.532987,66.711331 94.543142,77.980673 90.966081,81.670246 85.259173,81.668997 79.552261,81.667751 75.000211,74.999942 75.000211,74.999942 L 25.000021,25.000058"
        ></path>
        <path class="line line2 stroke-white" d="M 20,50 H 80"></path>
        <path
          class="line line3 stroke-white"
          d="M 20,70.999954 H 80.000231 C 80.000231,70.999954 94.498839,71.182648 94.532987,33.288669 94.543142,22.019327 90.966081,18.329754 85.259173,18.331003 79.552261,18.332249 75.000211,25.000058 75.000211,25.000058 L 25.000021,74.999942"
        ></path>
      </svg>
    </button>
    <ul
      id="primary-navigation"
      class="font-title md:px-5 translate-x-full md:translate-x-0 flex bg-offBlack/70 md:bg-transparent fixed top-0 bottom-0 left-0 sm:left-1/3 right-0 md:flex flex-col md:relative md:inset-0 md:flex-row gap-8 md:gap-5 lg:gap-10 pt-36 md:pt-0 place-items-center transition border border-neutral-500 md:border-0 rounded-l-3xl opacity-0 md:opacity-100 backdrop-blur-lg md:backdrop-blur-none"
    >
      <li class="navLi delay-50">
        <a id="first" href="/">Home</a>
      </li>
      <li class="navLi delay-100">
        <a href="/about">About</a>
      </li>
      <li class="navLi delay-150">
        <a href="/services">Services</a>
      </li>
      <li class="navLi delay-200">
        <a href="/contact">Contact</a>
      </li>
      <li class="navLi animate">
        <a href="tel:4124051059" class="whitespace-nowrap font-title bg-accent-blue md:rounded-full px-5 py-3 text-offBlack hover:bg-blue-500 hover:text-white active:bg-blue-700 w-full"
          >
            412-405-1059
          </a
        >
      </li>
    </ul>
  </nav>


</header>

<style>
  .navLi {
    @apply duration-500 translate-x-full md:translate-x-0 w-full transition cursor-pointer hover:bg-black/30 md:hover:bg-transparent invisible md:visible mx-auto flex place-content-center;
  }
  .navOpen,
  .navOpen > .navLi {
    @apply translate-x-0 opacity-100 visible;
  }
  li > a {
    @apply text-white no-underline w-full p-2 text-4xl md:text-base lg:text-2xl hover:text-accent-blue text-center;
  }
  #nav {
    @apply bg-transparent p-3 sm:px-5 sm:py-3 h-24 sm:h-32 text-white transition-all duration-500;
  }
  #nav.navChange {
    @apply h-20 bg-offBlack transition-all duration-500;
  }
</style>

<script>
  let hamburgerOpen = false;
  const hamburgerButton = document.getElementById("hamburgerButton");
  const navUl = document.querySelector("#primary-navigation");
  const navItems = document.querySelectorAll(".navLi>a");
  const hamburgerSvg = document.getElementById("hamburgerSvg");
  const body = document.querySelector("body");

  //hamburgerButton.addEventListener("click", handleClick);
  document.addEventListener("keydown", handleKeydown);
  document.addEventListener("click", handleClick);

  function toggleHambuger(close) {
    //toggle aria-expanded attribute
    if (close || hamburgerButton.ariaExpanded == "true") {
      hamburgerButton.ariaExpanded = "false";
      navUl.classList.remove("navOpen");
      hamburgerSvg.classList.remove("opened");
      body.classList.remove("overflow-y-hidden");
      // navItems.forEach((li, i) => {
      //   li.setAttribute("tabindex", "-1");
      //   li.setAttribute("visibility", "hidden");
      // });
    } else {
      hamburgerButton.ariaExpanded = "true";
      navUl.classList.add("navOpen");
      hamburgerSvg.classList.add("opened");
      body.classList.add("overflow-y-hidden");
      navItems.forEach((li, i) => {
        li.setAttribute("tabindex", "0");
        li.setAttribute("visibility", "visible");
      });

      console.log(navItems[0])
      document.getElementById("first").focus();
    }
  }

  function handleKeydown(e) {
    if (e.key === "Escape") {
      handleClick(e, true);
    }
  }

  function handleClick(e, close = false) {
    if (e.target.id !== "hamburgerButton") {
      close = true;

      console.log("hi", close);
    }
    toggleHambuger(close);
    //if escape is pressed, force close the menu
  }
  function windowResized() {
    toggleHambuger(true);
  }
  window.onresize = windowResized;
</script>

<script>
  //navbar change intersection observer
  const threshold = 0.2;
  const rootMargin = "-20% 0% 0% 0%";
  const heroSection = document.querySelector("#top");
  const navbar = document.querySelector("#nav");
  const heroObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (!entry.isIntersecting) {
          navbar.classList.add("navChange");
          console.log("not intersecting");
        } else {
          navbar.classList.remove("navChange");
          console.log("intersecting");
        }
      });
    },
    { threshold: threshold, rootMargin: rootMargin }
  );

  heroObserver.observe(heroSection);
</script>